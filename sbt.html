<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Scalastyle - SBT plugin" />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="stylesheets/stylesheet.css"
    />

    <title>Scalastyle - SBT plugin</title>
  </head>

  <body>
    <!-- HEADER -->
    <div id="header_wrap" class="outer">
      <header class="inner">
        <a
          id="forkme_banner"
          href="https://github.com/beautiful-scala/scalastyle"
          >View on GitHub</a
        >

        <h1 id="project_title">Scalastyle - SBT plugin</h1>
      </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3 id="overview">Overview</h3>

<p>This project is intended to provide Scala 2.11/2.12/2.13 &amp; SBT 1.x plugin
support for Scalastyle.</p>

<h3 id="repository">Repository</h3>

<p>The repository for the Scalastyle SBT plugin is:
<a href="https://oss.sonatype.org/content/repositories/releases/com/beautiful-scala">https://oss.sonatype.org/content/repositories/releases/com/beautiful-scala</a></p>

<h3 id="setup">Setup</h3>

<p>Add the following line to <code class="highlighter-rouge">project/plugins.sbt</code></p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">addSbtPlugin</span><span class="o">(</span><span class="s">"com.beautiful-scala"</span> <span class="o">%</span> <span class="s">"sbt-scalastyle"</span> <span class="o">%</span> <span class="s">"1.1.0"</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="usage">Usage</h3>

<p>You will need a configuration file. The easiest way to get one is to use the
scalastyleGenerateConfig command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt scalastyleGenerateConfig
</code></pre></div></div>

<p>This will create a scalastyle-config.xml in the current directory, with the
default settings. Then, you can check your code with the <code class="highlighter-rouge">scalastyle</code> command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt scalastyle
</code></pre></div></div>

<p>This produces a list of errors on the console, as well as an XML result file
<code class="highlighter-rouge">target/scalastyle-result.xml</code> (CheckStyle compatible format).</p>

<h3 id="configuration-options">Configuration options</h3>

<table>
  <thead>
    <tr>
      <th>Setting</th>
      <th style="text-align: left">Type</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>scalastyleTarget</td>
      <td style="text-align: left">File</td>
      <td style="text-align: left">XML file containing the Scalastyle report. Default value is <code class="highlighter-rouge">target/scalastyle-result.xml</code></td>
    </tr>
    <tr>
      <td>scalastyleConfig</td>
      <td style="text-align: left">File</td>
      <td style="text-align: left">Scalastyle configuration. Default value is <code class="highlighter-rouge">scalastyle-config.xml</code></td>
    </tr>
    <tr>
      <td>scalastyleConfigUrl</td>
      <td style="text-align: left">Option[URL]</td>
      <td style="text-align: left">Scalastyle configuration URL. If this is Some(url), then this will be used in preference to the setting <code class="highlighter-rouge">scalastyleConfig</code>. It is downloaded and stored in the <code class="highlighter-rouge">target</code> directory, and refreshed every <code class="highlighter-rouge">scalastyleConfigRefreshHours</code> hours. Default value is <code class="highlighter-rouge">None</code>.</td>
    </tr>
    <tr>
      <td>scalastyleConfigRefreshHours</td>
      <td style="text-align: left">Integer</td>
      <td style="text-align: left">If scalastyleConfigUrl is set, refresh it after this number of hours. Default value is 24.</td>
    </tr>
    <tr>
      <td>scalastyleFailOnError</td>
      <td style="text-align: left">Boolean</td>
      <td style="text-align: left">If true, the scalastyle task fails if any messages at error level are output. Default value is false.</td>
    </tr>
    <tr>
      <td>scalastyleFailOnWarning</td>
      <td style="text-align: left">Boolean</td>
      <td style="text-align: left">If true, the scalastyle task fails if any messages at warning level are output. Default value is false.</td>
    </tr>
    <tr>
      <td>scalastyleConfigUrlCacheFile</td>
      <td style="text-align: left">String</td>
      <td style="text-align: left">When scalastyleConfigUrl is used, the name of the local file in which it is stored. Default is <code class="highlighter-rouge">target/scalastyle-config.xml</code></td>
    </tr>
  </tbody>
</table>

<p>If the remote source for your <code class="highlighter-rouge">scalastyle-config.xml</code> file is secured and
requires the passing of tokens in the header of the http request or ssh
authentication then scalastyleConfigUrl will not suffice. A work around is to
define your own update task and make scalastyle depend on it in your <code class="highlighter-rouge">build.sbt</code>
or <code class="highlighter-rouge">Build.scala</code>.</p>

<p>This example use enterprise github (private repositories) through the REST API
v3, bitbucket API to get raw files is similar:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">lazy</span> <span class="k">val</span> <span class="nv">updateScalaStyle</span> <span class="k">=</span> <span class="n">taskKey</span><span class="o">[</span><span class="kt">Unit</span><span class="o">](</span><span class="s">"updateScalaStyle"</span><span class="o">)</span>

<span class="n">updateScalaStyle</span> <span class="o">:=</span> <span class="o">{</span>
    <span class="cm">/**
    * Create a security token under Github &gt; Profile Settings &gt; Application
    * add repo_org in the scope of that token
    * set it to environment variable SBT_GITHUB_TOKEN
    *
    * ex:
    * export SBT_GITHUB_TOKEN='1234567890abcdef1234567890abcdef'
    */</span>
    <span class="nv">sys</span><span class="o">.</span><span class="py">env</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="s">"SBT_GITHUB_TOKEN"</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">oauthToken</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="k">val</span> <span class="nv">configFileUrl</span> <span class="k">=</span> <span class="s">"https://raw.githubusercontent.com/[owner]/[repository]/[branch_or_commit]/[path]/scalastyle-config.xml"</span>
        <span class="k">val</span> <span class="nv">result</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="nf">file</span><span class="o">(</span><span class="s">"target/scalastyle-config.xml"</span><span class="o">)</span> <span class="o">#&lt;</span> <span class="n">s</span><span class="s">"curl --fail -u $oauthToken:x-oauth-basic $configFileUrl"</span> <span class="o">!</span>
    <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span>
        <span class="nf">println</span><span class="o">(</span><span class="s">"Please set system variable SBT_GITHUB_TOKEN to update scalastyle config file"</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="o">(</span><span class="n">scalastyle</span> <span class="n">in</span> <span class="nc">Compile</span><span class="o">)</span> <span class="o">&lt;&lt;=</span> <span class="o">(</span><span class="n">scalastyle</span> <span class="n">in</span> <span class="nc">Compile</span><span class="o">)</span> <span class="n">dependsOn</span> <span class="nf">updateScalaStyle</span>

<span class="o">(</span><span class="n">scalastyle</span> <span class="n">in</span> <span class="nc">Test</span><span class="o">)</span> <span class="o">&lt;&lt;=</span> <span class="o">(</span><span class="n">scalastyle</span> <span class="n">in</span> <span class="nc">Test</span><span class="o">)</span> <span class="n">dependsOn</span> <span class="n">updateScalaStyle</span>
</code></pre></div></div>

<p>NB: This uses <code class="highlighter-rouge">curl</code> so, while it works correctly on MacOS and Linux (or other
*NIX) it might give problem on windows environments.</p>

<h3 id="running-scalastyle-on-your-test-sources">Running scalastyle on your test sources</h3>

<p>You can check your test sources <code class="highlighter-rouge">(scalaSources in Test)</code> using the
<code class="highlighter-rouge">test:scalastyle</code> command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt <span class="nb">test</span>:scalastyle
</code></pre></div></div>

<p>This has exactly the same output as the scalastyle command, except that the
generated XML file is <code class="highlighter-rouge">target/scalastyle-test-result.xml</code> by default. All of the
configuration options for the <code class="highlighter-rouge">scalastyle</code> command are available in the Test
configuration for <code class="highlighter-rouge">test:scalastyle</code>, but you need to use the <code class="highlighter-rouge">Test</code>
configuration. For instance:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="n">scalastyleConfig</span> <span class="n">in</span> <span class="nc">Test</span><span class="o">)</span> <span class="o">:=</span> <span class="nv">baseDirectory</span><span class="o">.</span><span class="py">value</span> <span class="o">/</span> <span class="s">"scalastyle-test-config.xml"</span>
<span class="o">(</span><span class="n">scalastyleConfig</span> <span class="n">in</span> <span class="nc">Test</span><span class="o">)</span> <span class="o">:=</span> <span class="nf">file</span><span class="o">(</span><span class="s">"/foo/bar/scalastyle-test-config.xml"</span><span class="o">)</span>
<span class="o">(</span><span class="n">scalastyleConfigUrl</span> <span class="n">in</span> <span class="nc">Test</span><span class="o">)</span> <span class="o">:=</span> <span class="nc">Some</span><span class="o">(</span><span class="nf">url</span><span class="o">(</span><span class="s">"http://www.scalastyle.org/scalastyle_config.xml"</span><span class="o">))</span>
</code></pre></div></div>

<h3 id="running-scalastyle-as-part-of-another-task">Running scalastyle as part of another task</h3>

<p>You can also have your scalastyle checks automatically run as part of another
task:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a default Scala style task to run with tests</span>
<span class="k">lazy</span> <span class="k">val</span> <span class="nv">testScalastyle</span> <span class="k">=</span> <span class="n">taskKey</span><span class="o">[</span><span class="kt">Unit</span><span class="o">](</span><span class="s">"testScalastyle"</span><span class="o">)</span>

<span class="c1">// scalastyle &gt;= 0.9.0</span>
<span class="n">testScalastyle</span> <span class="o">:=</span> <span class="nv">scalastyle</span><span class="o">.</span><span class="py">in</span><span class="o">(</span><span class="nc">Test</span><span class="o">).</span><span class="py">toTask</span><span class="o">(</span><span class="s">""</span><span class="o">).</span><span class="py">value</span>
<span class="c1">// scalastyle &lt;= 0.8.0</span>
<span class="n">testScalastyle</span> <span class="o">:=</span> <span class="nv">org</span><span class="o">.</span><span class="py">scalastyle</span><span class="o">.</span><span class="py">sbt</span><span class="o">.</span><span class="py">ScalastylePlugin</span><span class="o">.</span><span class="py">scalastyle</span><span class="o">.</span><span class="py">in</span><span class="o">(</span><span class="nc">Test</span><span class="o">).</span><span class="py">toTask</span><span class="o">(</span><span class="s">""</span><span class="o">).</span><span class="py">value</span>

<span class="o">(</span><span class="n">test</span> <span class="n">in</span> <span class="nc">Test</span><span class="o">)</span> <span class="o">:=</span> <span class="o">((</span><span class="n">test</span> <span class="n">in</span> <span class="nc">Test</span><span class="o">)</span> <span class="n">dependsOn</span> <span class="n">testScalastyle</span><span class="o">).</span><span class="py">value</span>
</code></pre></div></div>

<p>or as part of the compile task:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">lazy</span> <span class="k">val</span> <span class="nv">compileScalastyle</span> <span class="k">=</span> <span class="n">taskKey</span><span class="o">[</span><span class="kt">Unit</span><span class="o">](</span><span class="s">"compileScalastyle"</span><span class="o">)</span>

<span class="c1">// scalastyle &gt;= 0.9.0</span>
<span class="n">compileScalastyle</span> <span class="o">:=</span> <span class="nv">scalastyle</span><span class="o">.</span><span class="py">in</span><span class="o">(</span><span class="nc">Compile</span><span class="o">).</span><span class="py">toTask</span><span class="o">(</span><span class="s">""</span><span class="o">).</span><span class="py">value</span>
<span class="c1">// scalastyle &lt;= 0.8.0</span>
<span class="n">compileScalastyle</span> <span class="o">:=</span> <span class="nv">org</span><span class="o">.</span><span class="py">scalastyle</span><span class="o">.</span><span class="py">sbt</span><span class="o">.</span><span class="py">ScalastylePlugin</span><span class="o">.</span><span class="py">scalastyle</span><span class="o">.</span><span class="py">in</span><span class="o">(</span><span class="nc">Compile</span><span class="o">).</span><span class="py">toTask</span><span class="o">(</span><span class="s">""</span><span class="o">).</span><span class="py">value</span>

<span class="o">(</span><span class="n">compile</span> <span class="n">in</span> <span class="nc">Compile</span><span class="o">)</span> <span class="o">:=</span> <span class="o">((</span><span class="n">compile</span> <span class="n">in</span> <span class="nc">Compile</span><span class="o">)</span> <span class="n">dependsOn</span> <span class="n">compileScalastyle</span><span class="o">).</span><span class="py">value</span>
</code></pre></div></div>

<p>But note that this makes the compile task dependent on the scalastyle task - the
scalastyle task executes first. This can cause problems because if the code
doesn’t compile, you’ll get the scalastyle errors messages, not the scalac ones.
Great though scalastyle is, it can’t match the error messages produced by the
compiler. :-)</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner"></footer>
    </div>
  </body>
</html>
